# 项目结构说明

## 文件列表

```
求职看板/
├── index.html              # 主页面
├── styles.css              # 样式文件
├── script.js               # 主要业务逻辑
├── config.js               # AI 配置管理
├── db.js                   # IndexedDB 数据库操作
├── ai-parser.js            # AI 解析模块
├── README.md               # 项目说明
├── 使用示例.md             # 详细使用示例
├── AI配置指南.md           # AI 服务配置教程
└── 数据迁移说明.md         # 数据迁移和备份指南
```

## 核心文件说明

### index.html
主页面文件，包含：
- 页面结构和布局
- 三个池子（待研究、待投递、已投递）
- 各种模态框（快速录入、简历管理、投递进展、设置）
- 引入所有 JS 和 CSS 文件

### styles.css
样式文件，包含：
- 整体布局样式
- 卡片和看板样式
- 模态框样式
- 响应式设计
- 动画效果

### script.js
主要业务逻辑，包含：
- 数据加载和渲染
- 职位和简历的增删改查
- 拖拽功能
- 快速录入（本地识别）
- 简历管理
- 投递进展统计
- 设置界面
- 数据导出/导入
- UI 辅助函数（加载动画、提示消息）

### config.js
AI 配置管理，包含：
- 支持的 AI 服务配置（OpenAI、DeepSeek、智谱 AI、本地模型）
- 配置的加载和保存
- 配置项说明

### db.js
IndexedDB 数据库操作，包含：
- 数据库初始化
- 职位数据的增删改查
- 简历数据的增删改查
- 数据导出为 JSON
- 数据从 JSON 导入
- 从旧版本 LocalStorage 迁移数据

### ai-parser.js
AI 解析模块，包含：
- 调用不同 AI 服务的 API
- 解析 AI 返回结果
- 本地正则表达式解析（备用方案）
- 错误处理

## 数据流程

### 1. 应用启动
```
用户打开 index.html
    ↓
initApp() 初始化
    ↓
jobDB.init() 初始化数据库
    ↓
loadData() 加载数据
    ↓
renderAll() 渲染界面
```

### 2. 添加职位（快速录入）
```
用户输入招聘信息
    ↓
点击"本地识别"或"AI 识别"
    ↓
parseQuickText() 或 parseWithAI()
    ↓
显示识别结果预览
    ↓
用户确认并保存
    ↓
saveJob() 保存到数据库
    ↓
loadData() 重新加载
    ↓
renderPool() 更新显示
```

### 3. 移动职位
```
用户拖拽卡片或点击箭头
    ↓
moveItem(itemId, fromPool, toPool)
    ↓
更新 item.pool 属性
    ↓
saveJob() 保存到数据库
    ↓
loadData() 重新加载
    ↓
renderPool() 更新显示
```

### 4. 数据导出
```
用户点击"导出数据"
    ↓
exportAllData()
    ↓
jobDB.exportData() 从数据库读取
    ↓
生成 JSON 文件
    ↓
触发浏览器下载
```

### 5. 数据导入
```
用户选择 JSON 文件
    ↓
importDataFile()
    ↓
读取文件内容
    ↓
jobDB.importData() 写入数据库
    ↓
loadData() 重新加载
    ↓
renderAll() 更新显示
```

## 数据结构

### 职位数据 (Job)
```javascript
{
    id: "1234567890",           // 唯一标识
    pool: "research",            // 所属池子: research/pending/applied
    companyName: "阿里巴巴",     // 企业名称
    position: "前端工程师",      // 岗位名称
    location: "杭州",            // 工作地点
    salary: "20-35K",            // 薪资范围
    industry: "互联网",          // 所属行业
    status: "已投递",            // 投递状态（仅 applied 池）
    resumeUsed: "resume_id",     // 使用的简历 ID（仅 applied 池）
    applyDate: "2025-11-16",     // 投递日期（仅 applied 池）
    notes: "备注信息",           // 备注
    createdAt: "2025-11-16T10:00:00.000Z",  // 创建时间
    updatedAt: "2025-11-16T10:00:00.000Z"   // 更新时间
}
```

### 简历数据 (Resume)
```javascript
{
    id: "9876543210",            // 唯一标识
    name: "互联网通用版",        // 简历名称
    version: "v2.3",             // 版本号
    target: "前端工程师",        // 目标岗位
    file: "D:/简历/前端.pdf",    // 文件路径
    notes: "适合互联网大厂",     // 备注
    createdAt: "2025-11-01T10:00:00.000Z",  // 创建时间
    updatedAt: "2025-11-16T10:00:00.000Z"   // 更新时间
}
```

### AI 配置 (AI_CONFIG)
```javascript
{
    provider: "openai",          // 当前使用的服务商
    openai: {
        apiKey: "sk-xxx",        // API Key
        model: "gpt-3.5-turbo",  // 模型名称
        baseURL: "https://api.openai.com/v1"  // API 地址
    },
    deepseek: { ... },
    zhipu: { ... },
    local: { ... }
}
```

## 关键函数说明

### 数据操作
- `loadData()` - 从数据库加载所有数据
- `saveJob(job)` - 保存职位到数据库
- `deleteJobFromDB(id)` - 删除职位
- `saveResumeData(resume)` - 保存简历
- `deleteResumeFromDB(id)` - 删除简历

### 渲染函数
- `renderAll()` - 渲染所有池子
- `renderPool(poolName)` - 渲染单个池子
- `createCard(item, poolName)` - 创建职位卡片 HTML
- `renderResumeList()` - 渲染简历列表
- `updateStats()` - 更新统计数据

### 业务逻辑
- `openModal(poolName, itemId)` - 打开添加/编辑模态框
- `moveItem(itemId, fromPool, toPool)` - 移动职位
- `parseQuickText()` - 本地正则解析
- `parseWithAI()` - AI 智能解析
- `exportAllData()` - 导出数据
- `importDataFile(event)` - 导入数据

### UI 辅助
- `showLoading(text)` - 显示加载动画
- `hideLoading()` - 隐藏加载动画
- `showToast(title, message, type)` - 显示提示消息

## 扩展开发指南

### 添加新的 AI 服务

1. 在 `config.js` 中添加配置：
```javascript
AI_CONFIG.newservice = {
    apiKey: '',
    model: 'model-name',
    baseURL: 'https://api.example.com'
};
```

2. 在 `ai-parser.js` 中添加调用方法：
```javascript
async callNewServiceAPI(text, config) {
    // 实现 API 调用逻辑
}
```

3. 在 `AIParser.parse()` 中添加分支：
```javascript
if (provider === 'newservice') {
    result = await this.callNewServiceAPI(text, config);
}
```

4. 在 `index.html` 设置界面添加选项：
```html
<option value="newservice">新服务</option>
```

### 添加新的数据字段

1. 在 `index.html` 表单中添加输入框
2. 在 `script.js` 的表单提交处理中添加字段
3. 在 `createCard()` 中添加显示逻辑
4. 更新数据结构文档

### 添加新的统计维度

1. 在 `updateStats()` 中添加计算逻辑
2. 在 `index.html` 头部添加统计显示
3. 在 `openProgressView()` 中添加详细统计

## 性能优化建议

1. **大量数据时**：
   - 使用虚拟滚动
   - 分页加载
   - 延迟渲染

2. **频繁操作时**：
   - 使用防抖（debounce）
   - 批量更新
   - 减少 DOM 操作

3. **AI 调用时**：
   - 添加请求缓存
   - 实现请求队列
   - 设置超时时间

## 安全注意事项

1. **API Key 安全**：
   - 仅存储在本地
   - 不要提交到代码仓库
   - 定期更换

2. **数据安全**：
   - 定期备份
   - 导出文件加密（可选）
   - 不在公共电脑使用

3. **XSS 防护**：
   - 用户输入已做转义
   - 不使用 `innerHTML` 插入用户数据
   - 使用 `textContent` 或模板字符串

## 浏览器兼容性

- Chrome 80+
- Edge 80+
- Firefox 75+
- Safari 13+

主要依赖：
- IndexedDB API
- Fetch API
- ES6+ 语法
- CSS Grid/Flexbox

## 调试技巧

### 查看数据库内容
```javascript
// 在浏览器控制台执行
jobDB.getAllJobs().then(jobs => console.table(jobs));
jobDB.getAllResumes().then(resumes => console.table(resumes));
```

### 清空数据库
```javascript
jobDB.clearAll().then(() => console.log('已清空'));
```

### 查看 AI 配置
```javascript
console.log(AI_CONFIG);
```

### 测试 AI 解析
```javascript
const text = "阿里巴巴 - 前端工程师\n杭州 20-35K";
aiParser.parse(text).then(result => console.log(result));
```
