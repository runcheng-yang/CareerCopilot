<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人求职看板</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>🎯 个人求职看板</h1>
                <div class="header-actions">
                    <button class="header-btn" onclick="openResumeManager()">📄 简历管理</button>
                    <button class="header-btn" onclick="openQuickAdd()">⚡ 快速录入</button>
                    <button class="header-btn" onclick="openProgressView()">📈 投递进展</button>
                    <button class="header-btn" onclick="openSettings()">⚙️ 设置</button>
                </div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="researchCount">0</span>
                    <span class="stat-label">待研究</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="pendingCount">0</span>
                    <span class="stat-label">待投递</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="appliedCount">0</span>
                    <span class="stat-label">已投递</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="interviewCount">0</span>
                    <span class="stat-label">面试中</span>
                </div>
            </div>
        </header>

        <div class="board">
            <!-- 待研究企业池 -->
            <div class="column">
                <div class="column-header research">
                    <h2>📋 待研究企业</h2>
                    <button class="add-btn" onclick="openModal('research')">+ 添加</button>
                </div>
                <div class="cards-container" id="researchPool"></div>
            </div>

            <!-- 待投递岗位池 -->
            <div class="column">
                <div class="column-header pending">
                    <h2>📤 待投递岗位</h2>
                    <button class="add-btn" onclick="openModal('pending')">+ 添加</button>
                </div>
                <div class="cards-container" id="pendingPool"></div>
            </div>

            <!-- 已投递企业池 -->
            <div class="column">
                <div class="column-header applied">
                    <h2>✅ 已投递企业</h2>
                    <button class="add-btn" onclick="openModal('applied')">+ 添加</button>
                </div>
                <div class="cards-container" id="appliedPool"></div>
            </div>
        </div>
    </div>

    <!-- 快速录入模态框 -->
    <div id="quickAddModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQuickAdd()">&times;</span>
            <h2>⚡ 快速录入</h2>
            <p class="modal-desc">复制招聘信息，系统将自动识别企业名称、岗位、薪资等信息</p>
            <form id="quickAddForm">
                <div class="form-group">
                    <label for="quickText">粘贴招聘信息</label>
                    <textarea id="quickText" rows="8" placeholder="例如：
阿里巴巴 - 高级前端工程师
地点：杭州
薪资：25-40K
要求：3年以上经验，熟悉React/Vue"></textarea>
                </div>
                <div class="form-group">
                    <label for="quickPool">添加到</label>
                    <select id="quickPool">
                        <option value="research">待研究企业</option>
                        <option value="pending" selected>待投递岗位</option>
                    </select>
                </div>
                <div id="quickPreview" class="quick-preview"></div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeQuickAdd()">取消</button>
                    <button type="button" class="btn-secondary" onclick="parseQuickText()">🔍 本地识别</button>
                    <button type="button" class="btn-ai" onclick="parseWithAI()">🤖 AI 识别</button>
                    <button type="submit" class="btn-submit">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 简历管理模态框 -->
    <div id="resumeModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeResumeManager()">&times;</span>
            <h2>📄 简历管理</h2>
            <div class="resume-container">
                <div class="resume-sidebar">
                    <button class="resume-add-btn" onclick="addResume()">+ 新建简历</button>
                    <div id="resumeList" class="resume-list"></div>
                </div>
                <div class="resume-editor">
                    <div id="resumeEditor">
                        <div class="empty-state">
                            <div class="empty-state-icon">📝</div>
                            <div class="empty-state-text">选择或创建一个简历</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 简历编辑表单 -->
    <div id="resumeEditModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeResumeEdit()">&times;</span>
            <h2 id="resumeEditTitle">编辑简历</h2>
            <form id="resumeEditForm">
                <input type="hidden" id="resumeId">
                <div class="form-group">
                    <label for="resumeName">简历名称 *</label>
                    <input type="text" id="resumeName" required placeholder="如：互联网通用版、金融行业版">
                </div>
                <div class="form-group">
                    <label for="resumeVersion">版本号</label>
                    <input type="text" id="resumeVersion" placeholder="如：v1.0">
                </div>
                <div class="form-group">
                    <label for="resumeTarget">目标岗位</label>
                    <input type="text" id="resumeTarget" placeholder="如：前端工程师、产品经理">
                </div>
                <div class="form-group">
                    <label for="resumeFile">文件链接/路径</label>
                    <input type="text" id="resumeFile" placeholder="简历文件的存储位置">
                </div>
                <div class="form-group">
                    <label for="resumeNotes">备注</label>
                    <textarea id="resumeNotes" rows="3" placeholder="记录简历特点、适用场景等"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeResumeEdit()">取消</button>
                    <button type="submit" class="btn-submit">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 投递进展模态框 -->
    <div id="progressModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeProgressView()">&times;</span>
            <h2>📈 投递进展</h2>
            <div class="progress-stats">
                <div class="progress-stat-card">
                    <div class="progress-stat-number" id="totalApplied">0</div>
                    <div class="progress-stat-label">总投递</div>
                </div>
                <div class="progress-stat-card">
                    <div class="progress-stat-number" id="totalViewed">0</div>
                    <div class="progress-stat-label">已查看</div>
                </div>
                <div class="progress-stat-card">
                    <div class="progress-stat-number" id="totalInterview">0</div>
                    <div class="progress-stat-label">面试邀请</div>
                </div>
                <div class="progress-stat-card">
                    <div class="progress-stat-number" id="totalPassed">0</div>
                    <div class="progress-stat-label">已通过</div>
                </div>
                <div class="progress-stat-card">
                    <div class="progress-stat-number" id="totalRejected">0</div>
                    <div class="progress-stat-label">已拒绝</div>
                </div>
            </div>
            <div class="progress-timeline">
                <h3>最近投递记录</h3>
                <div id="progressTimeline"></div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">添加项目</h2>
            <form id="itemForm">
                <input type="hidden" id="itemId">
                <input type="hidden" id="itemPool">
                
                <div class="form-group">
                    <label for="companyName">企业名称 *</label>
                    <input type="text" id="companyName" required>
                </div>

                <div class="form-group" id="positionGroup">
                    <label for="position">岗位名称</label>
                    <input type="text" id="position">
                </div>

                <div class="form-group">
                    <label for="industry">行业</label>
                    <input type="text" id="industry" placeholder="如：互联网、金融、教育">
                </div>

                <div class="form-group">
                    <label for="location">地点</label>
                    <input type="text" id="location" placeholder="如：北京、上海">
                </div>

                <div class="form-group" id="salaryGroup">
                    <label for="salary">薪资范围</label>
                    <input type="text" id="salary" placeholder="如：15-25K">
                </div>

                <div class="form-group" id="statusGroup">
                    <label for="status">投递状态</label>
                    <select id="status">
                        <option value="已投递">已投递</option>
                        <option value="已查看">已查看</option>
                        <option value="面试邀请">面试邀请</option>
                        <option value="已面试">已面试</option>
                        <option value="已拒绝">已拒绝</option>
                        <option value="已通过">已通过</option>
                    </select>
                </div>

                <div class="form-group" id="resumeGroup">
                    <label for="resumeUsed">使用简历</label>
                    <select id="resumeUsed">
                        <option value="">未选择</option>
                    </select>
                </div>

                <div class="form-group" id="applyDateGroup">
                    <label for="applyDate">投递日期</label>
                    <input type="date" id="applyDate">
                </div>

                <div class="form-group">
                    <label for="notes">备注</label>
                    <textarea id="notes" rows="3"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeModal()">取消</button>
                    <button type="submit" class="btn-submit">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeSettings()">&times;</span>
            <h2>⚙️ 设置</h2>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="switchSettingsTab('ai')">AI 配置</button>
                <button class="settings-tab" onclick="switchSettingsTab('data')">数据管理</button>
            </div>

            <!-- AI 配置 -->
            <div id="aiSettings" class="settings-panel">
                <div class="form-group">
                    <label for="aiProvider">AI 服务提供商</label>
                    <select id="aiProvider" onchange="updateAIProviderFields()">
                        <option value="openai">OpenAI (ChatGPT)</option>
                        <option value="deepseek">DeepSeek</option>
                        <option value="zhipu">智谱 AI (GLM)</option>
                        <option value="local">本地模型 (Ollama)</option>
                    </select>
                </div>

                <div id="apiKeyGroup" class="form-group">
                    <label for="aiApiKey">API Key</label>
                    <input type="password" id="aiApiKey" placeholder="输入你的 API Key">
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        API Key 仅保存在本地浏览器，不会上传到任何服务器
                    </small>
                </div>

                <div class="form-group">
                    <label for="aiModel">模型</label>
                    <input type="text" id="aiModel" placeholder="如：gpt-3.5-turbo">
                </div>

                <div class="form-group">
                    <label for="aiBaseURL">API 地址</label>
                    <input type="text" id="aiBaseURL" placeholder="如：https://api.openai.com/v1">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-submit" onclick="saveAISettings()">保存配置</button>
                    <button type="button" class="btn-secondary" onclick="testAIConnection()">测试连接</button>
                </div>

                <div class="settings-info">
                    <h4>💡 使用说明</h4>
                    <ul>
                        <li><strong>OpenAI:</strong> 需要 OpenAI API Key，支持 GPT-3.5/GPT-4</li>
                        <li><strong>DeepSeek:</strong> 国内可用，性价比高，需要 DeepSeek API Key</li>
                        <li><strong>智谱 AI:</strong> 国内服务，需要智谱 API Key</li>
                        <li><strong>本地模型:</strong> 使用 Ollama 等本地部署的模型，无需 API Key</li>
                    </ul>
                </div>
            </div>

            <!-- 数据管理 -->
            <div id="dataSettings" class="settings-panel" style="display: none;">
                <div class="data-management">
                    <div class="data-section">
                        <h3>📤 导出数据</h3>
                        <p>将所有数据导出为 JSON 文件，可在其他电脑上导入使用</p>
                        <button class="btn-submit" onclick="exportAllData()">导出数据</button>
                    </div>

                    <div class="data-section">
                        <h3>📥 导入数据</h3>
                        <p>从 JSON 文件导入数据（会覆盖现有数据，请先备份）</p>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importDataFile(event)">
                        <button class="btn-secondary" onclick="document.getElementById('importFile').click()">选择文件导入</button>
                    </div>

                    <div class="data-section">
                        <h3>🔄 数据迁移</h3>
                        <p>从旧版本的 LocalStorage 迁移数据到新的数据库</p>
                        <button class="btn-secondary" onclick="migrateOldData()">开始迁移</button>
                    </div>

                    <div class="data-section danger">
                        <h3>🗑️ 清空数据</h3>
                        <p>删除所有数据，此操作不可恢复！</p>
                        <button class="btn-danger" onclick="clearAllData()">清空所有数据</button>
                    </div>
                </div>

                <div class="settings-info">
                    <h4>💡 数据说明</h4>
                    <ul>
                        <li>数据使用 IndexedDB 存储，比 LocalStorage 更稳定可靠</li>
                        <li>导出的 JSON 文件可以在任何电脑上导入使用</li>
                        <li>建议定期导出数据备份，防止数据丢失</li>
                        <li>更换浏览器或清除浏览器数据前，请先导出备份</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="db.js"></script>
    <script src="ai-parser.js"></script>
    <script src="script.js"></script>
</body>
</html>
