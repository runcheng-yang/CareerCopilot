# 数据迁移说明

## 为什么要迁移数据？

新版本使用 **IndexedDB** 替代了旧版本的 **LocalStorage**，带来以下优势：

1. **更大容量**：IndexedDB 可存储几百 MB 数据，LocalStorage 只有 5-10MB
2. **更好性能**：异步操作，不会阻塞页面
3. **更稳定**：不易因浏览器清理而丢失
4. **更易迁移**：支持导出/导入 JSON 文件

## 迁移方式

### 方式一：自动迁移（推荐）

如果你之前使用过旧版本：

1. 打开应用
2. 点击"⚙️ 设置"
3. 切换到"数据管理"标签
4. 点击"开始迁移"按钮
5. 等待迁移完成

系统会自动从 LocalStorage 读取旧数据并导入到新数据库。

### 方式二：手动导出导入

如果自动迁移失败，或需要在不同电脑间迁移：

**在旧电脑上：**
1. 打开浏览器开发者工具（F12）
2. 进入 Console 标签
3. 执行以下代码：

```javascript
// 导出职位数据
const jobData = localStorage.getItem('jobBoardData');
const resumeData = localStorage.getItem('resumeData');

const exportData = {
    version: 1,
    exportDate: new Date().toISOString(),
    jobs: [],
    resumes: JSON.parse(resumeData || '[]')
};

// 转换职位数据格式
const oldJobs = JSON.parse(jobData || '{"research":[],"pending":[],"applied":[]}');
exportData.jobs = [
    ...oldJobs.research.map(j => ({...j, pool: 'research'})),
    ...oldJobs.pending.map(j => ({...j, pool: 'pending'})),
    ...oldJobs.applied.map(j => ({...j, pool: 'applied'}))
];

// 下载数据
const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = '求职看板数据_备份.json';
a.click();
```

**在新电脑上：**
1. 打开应用
2. 点击"⚙️ 设置" → "数据管理"
3. 点击"选择文件导入"
4. 选择刚才导出的 JSON 文件

## 跨电脑使用

### 场景：在家里和公司都要用

**方法一：定期同步**
1. 在电脑 A 上使用后，导出数据
2. 将 JSON 文件保存到云盘（如百度网盘、OneDrive）
3. 在电脑 B 上下载文件并导入

**方法二：使用 U 盘**
1. 将整个应用文件夹复制到 U 盘
2. 在任何电脑上都可以直接打开使用
3. 数据会保存在该电脑的浏览器中

**方法三：使用便携浏览器**
1. 使用 Chrome Portable 或 Firefox Portable
2. 将浏览器和应用都放在 U 盘
3. 数据随浏览器走，到哪都能用

## 数据备份建议

### 备份频率

- **轻度使用**（每周添加 < 10 条）：每月备份一次
- **中度使用**（每周添加 10-30 条）：每周备份一次
- **重度使用**（每天都在用）：每天备份一次

### 备份方法

1. 点击"设置" → "数据管理" → "导出数据"
2. 将文件重命名为：`求职看板_YYYYMMDD.json`
3. 保存到：
   - 云盘（推荐）
   - 本地备份文件夹
   - 邮箱（发给自己）

### 自动备份脚本（高级）

如果你熟悉编程，可以设置定时任务：

**Windows (PowerShell):**
```powershell
# 保存为 backup.ps1
$date = Get-Date -Format "yyyyMMdd"
$source = "C:\path\to\求职看板数据.json"
$dest = "D:\Backup\求职看板_$date.json"
Copy-Item $source $dest
```

**Mac/Linux (Bash):**
```bash
#!/bin/bash
# 保存为 backup.sh
date=$(date +%Y%m%d)
cp ~/Downloads/求职看板数据.json ~/Backup/求职看板_$date.json
```

## 常见问题

### Q: 迁移后旧数据还在吗？

A: 在。迁移只是复制数据，不会删除 LocalStorage 中的旧数据。如果确认迁移成功，可以手动清理：

```javascript
localStorage.removeItem('jobBoardData');
localStorage.removeItem('resumeData');
```

### Q: 可以同时在多个浏览器使用吗？

A: 可以，但数据不会自动同步。每个浏览器的数据是独立的。建议：
- 选择一个主力浏览器
- 定期导出数据
- 在其他浏览器导入最新数据

### Q: 更换电脑后如何迁移？

A: 
1. 在旧电脑上导出数据
2. 将 JSON 文件传到新电脑（U盘、云盘、邮件等）
3. 在新电脑上打开应用并导入数据

### Q: 数据会丢失吗？

A: IndexedDB 比 LocalStorage 更稳定，但仍建议：
- 定期导出备份
- 不要使用浏览器的"清除所有数据"功能
- 使用"清除缓存"时不要勾选"Cookie 和其他网站数据"

### Q: 导入数据会覆盖现有数据吗？

A: 是的。导入前会提示确认，建议先导出当前数据作为备份。

### Q: 可以合并两个数据文件吗？

A: 目前不支持自动合并。如需合并：
1. 用文本编辑器打开两个 JSON 文件
2. 手动合并 `jobs` 和 `resumes` 数组
3. 确保没有重复的 `id`
4. 导入合并后的文件

## 数据格式说明

导出的 JSON 文件格式：

```json
{
  "version": 1,
  "exportDate": "2025-11-16T10:30:00.000Z",
  "jobs": [
    {
      "id": "1234567890",
      "pool": "research",
      "companyName": "阿里巴巴",
      "position": "前端工程师",
      "location": "杭州",
      "salary": "20-35K",
      "industry": "互联网",
      "notes": "备注信息",
      "createdAt": "2025-11-16T10:00:00.000Z",
      "updatedAt": "2025-11-16T10:00:00.000Z"
    }
  ],
  "resumes": [
    {
      "id": "9876543210",
      "name": "互联网通用版",
      "version": "v2.3",
      "target": "前端工程师",
      "file": "D:/简历/前端_v2.3.pdf",
      "notes": "适合互联网大厂",
      "createdAt": "2025-11-01T10:00:00.000Z",
      "updatedAt": "2025-11-16T10:00:00.000Z"
    }
  ]
}
```

## 技术细节

### IndexedDB vs LocalStorage

| 特性 | IndexedDB | LocalStorage |
|------|-----------|--------------|
| 容量 | 几百 MB | 5-10 MB |
| 性能 | 异步，不阻塞 | 同步，可能卡顿 |
| 数据类型 | 对象、数组等 | 仅字符串 |
| 查询 | 支持索引查询 | 需遍历 |
| 稳定性 | 高 | 中等 |
| 浏览器支持 | 现代浏览器 | 所有浏览器 |

### 为什么选择 IndexedDB？

1. **容量更大**：可以存储数千条求职记录
2. **性能更好**：大量数据时不会卡顿
3. **功能更强**：支持按状态、日期等快速查询
4. **更稳定**：不易因浏览器清理而丢失

### 数据存储位置

- **Windows**: `C:\Users\[用户名]\AppData\Local\[浏览器]\User Data\Default\IndexedDB`
- **Mac**: `~/Library/Application Support/[浏览器]/Default/IndexedDB`
- **Linux**: `~/.config/[浏览器]/Default/IndexedDB`

注意：这些是浏览器管理的数据库文件，不建议直接操作。请使用应用的导出/导入功能。
